#!/usr/bin/env bash

. $HOME/.Xresourceshelper

get_bar_color_by_id () {
	# get_bar_color_by_id COLOR_BAR 1
	# http://stackoverflow.com/a/16461878
	local color_array_name
	local color_array
	color_array_name="$1[@]"
	color_array=("${!color_array_name}")
	echo -n "${color_array[$2]}"
}

# {{{
# the colour tuples are zero-indexed of the form (FG,BG,underline)
bar_color_fg () {
	get_bar_color_by_id "$1" "0"
}

bar_color_bg () {
	get_bar_color_by_id "$1" "1"
}

bar_color_underline () {
	get_bar_color_by_id "$1" "2"
}
# }}}

bar_color () {
	# i.e. bar_color COLOR_BAR "$(date)"
	local bg_col
	local fg_col
	local underline_col
	bg_col="$(bar_color_bg "$1")"
	fg_col="$(bar_color_fg "$1")"
	underline_col="$(bar_color_underline "$1")"

	# if we haven't got a underline colour set, simply use the background colour
	if [[ "$underline_col" == "" ]];
	then
		underline_col="${bg_col}"
	fi

	echo -n "%{B${bg_col}}%{F${fg_col}}%{U${underline_col}}%{+u}${@:2}%{-u}%{U-}%{F-}%{B-}"
}

# Colour settings from our Xresources {{{
_BG="$(rgb_to_rgba "$(colour_from_xresources "col_bg")")"
_FG="$(rgb_to_rgba "$(colour_from_xresources "col_fg")")"

_BLACK="$(rgb_to_rgba "$(colour_from_xresources "col_black")")"
_RED="$(rgb_to_rgba "$(colour_from_xresources "col_red")")"
_GREEN="$(rgb_to_rgba "$(colour_from_xresources "col_green")")"
_YELLOW="$(rgb_to_rgba "$(colour_from_xresources "col_yellow")")"
_BLUE="$(rgb_to_rgba "$(colour_from_xresources "col_blue")")"
_MAGENTA="$(rgb_to_rgba "$(colour_from_xresources "col_magenta")")"
_CYAN="$(rgb_to_rgba "$(colour_from_xresources "col_cyan")")"
_WHITE="$(rgb_to_rgba "$(colour_from_xresources "col_white")")"

_BLACK_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_black_dark")")"
_RED_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_red_dark")")"
_GREEN_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_green_dark")")"
_YELLOW_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_yellow_dark")")"
_BLUE_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_blue_dark")")"
_MAGENTA_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_magenta_dark")")"
_CYAN_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_cyan_dark")")"
_WHITE_DARK="$(rgb_to_rgba "$(colour_from_xresources "col_white_dark")")"
# }}}

# Colour aliases for ease-of-use {{{
_FG_COL="$_WHITE"
_BG_COL="$_BG"
_FOCUSSED="$(rgb_to_rgba "$(colour_from_xresources "col_focussed")")"
_ACTIVE="$(rgb_to_rgba "$(colour_from_xresources "col_active")")"
_GREY="$_WHITE"
_VIOLET="$_MAGENTA"

# Note that we will need to use the syntax found at
# http://stackoverflow.com/a/12304017/2257038 to assign other variables to this
TUPLE_DEFAULT=($_FG $_BG $_BG)
TUPLE_ERROR=($_FG $_RED $_RED_DARK)
TUPLE_WARNING=($_BG $_YELLOW_DARK $_RED_DARK)
TUPLE_HIGHLIGHT_SUBTLE=($_FG $_BG $_RED)
# }}}

COLOR_BAR=("${TUPLE_DEFAULT[@]}")

# WM settings {{{
COLOR_ACTIVE_MONITOR=($_FG $_BG $_FOCUSSED)
COLOR_INACTIVE_MONITOR=("${TUPLE_DEFAULT[@]}")

COLOR_ACTIVE_OCCUPIED=($_FG $_BG $_FOCUSSED)
COLOR_INACTIVE_OCCUPIED=($_FG $_BG $_ACTIVE)

COLOR_ACTIVE_URGENT=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_INACTIVE_URGENT=("${TUPLE_ERROR[@]}")

COLOR_ACTIVE_FREE=($_FG $_BG $_WHITE)
COLOR_INACTIVE_FREE=("${TUPLE_DEFAULT[@]}")

COLOR_LAYOUT=($_FG $_BG $_BLUE)
# }}}

COLOR_TITLE=("${TUPLE_DEFAULT[@]}")

# Package updates {{{
COLOR_PACKAGE_IMPORTANT=("${TUPLE_ERROR[@]}")
COLOR_PACKAGE=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_PACKAGE_NONE=("${TUPLE_DEFAULT[@]}")
# }}}

# Network settings {{{
COLOR_NETWORK_TUN=($_FG $_BG $_VIOLET)
COLOR_NETWORK_NORMAL=($_FG $_BG $_GREEN)
COLOR_NETWORK_DIS=("${TUPLE_ERROR[@]}")
# }}}

# Volume colours {{{
COLOR_VOLUME_ON=($_FG $_BG $_MAGENTA)
COLOR_VOLUME_OFF=("${TUPLE_DEFAULT[@]}")
# }}}

# Battery colours {{{
COLOR_BATTERY_CRITICAL=("${TUPLE_ERROR[@]}")
COLOR_BATTERY_LOW=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_BATTERY_NORMAL=("${TUPLE_DEFAULT[@]}")
# }}}

COLOR_HOSTNAME=("${TUPLE_DEFAULT[@]}")

# Display different colours dependent on the system time {{{
COLOR_CLOCK_NORMAL=("${TUPLE_DEFAULT[@]}")
COLOR_CLOCK_LATE=("${TUPLE_ERROR[@]}")
# }}}

# Music colours {{{
COLOR_MUSIC_PLAYING=($_FG $_BG $_GREEN)
COLOR_MUSIC_PAUSED=($_FG $_BG $_YELLOW)
# TODO this will never be used; when stopped there is no status output
COLOR_MUSIC_STOPPED=($_FG $_BG $_BLUE)
# }}}

# Load indicators {{{
COLOR_LOAD_HIGH_TEMP=("${TUPLE_ERROR[@]}")
COLOR_LOAD_MEDIUM_TEMP=("${TUPLE_WARNING[@]}")
COLOR_LOAD_LOW_TEMP=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_LOAD_NORMAL_TEMP=("${TUPLE_DEFAULT[@]}")

COLOR_LOAD_HIGH_MEMORY_USAGE=("${TUPLE_ERROR[@]}")
COLOR_LOAD_MEDIUM_MEMORY_USAGE=("${TUPLE_WARNING[@]}")
COLOR_LOAD_LOW_MEMORY_USAGE=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_LOAD_NORMAL_MEMORY_USAGE=("${TUPLE_DEFAULT[@]}")

COLOR_LOAD_HIGH_CPU_USAGE=("${TUPLE_ERROR[@]}")
COLOR_LOAD_MEDIUM_CPU_USAGE=("${TUPLE_WARNING[@]}")
COLOR_LOAD_LOW_CPU_USAGE=("${TUPLE_HIGHLIGHT_SUBTLE[@]}")
COLOR_LOAD_NORMAL_CPU_USAGE=("${TUPLE_DEFAULT[@]}")
# }}}
