#!/usr/bin/env bash

. $HOME/.Xresourceshelper

get_bar_color_by_id () {
	# get_bar_color_by_id COLOR_BAR 1
	# http://stackoverflow.com/a/16461878
	local color_array_name
	local color_array
	color_array_name="$1[@]"
	color_array=("${!color_array_name}")
	echo -n "${color_array[$2]}"
}

# {{{
# the colour tuples are zero-indexed of the form (FG,BG,underline)
bar_color_fg () {
	get_bar_color_by_id "$1" "0"
}

bar_color_bg () {
	get_bar_color_by_id "$1" "1"
}

bar_color_underline () {
	get_bar_color_by_id "$1" "2"
}
# }}}

bar_color () {
	# i.e. bar_color COLOR_BAR "$(date)"
	local bg_col
	local fg_col
	local underline_col
	bg_col="$(bar_color_bg "$1")"
	fg_col="$(bar_color_fg "$1")"
	underline_col="$(bar_color_underline "$1")"

	# if we haven't got a underline colour set, simply use the background colour
	if [[ "$underline_col" == "" ]];
	then
		underline_col="${bg_col}"
	fi

	echo -n "%{B${bg_col}}%{F${fg_col}}%{U${underline_col}}%{+u}${@:2}%{-u}%{U-}%{F-}%{B-}"
}

bar_underline () {
	echo -n "%{U$1}%{+u}${@:2}%{-u}"
}

## Colours taken from NLKNguyen/papercolor-theme
_RED="$(rgb_to_rgba $(colour_from_xresources "col_red"))"
_ORANGE="$(rgb_to_rgba $(colour_from_xresources "col_yellow"))"
_YELLOW="$(rgb_to_rgba $(colour_from_xresources "col_yellow_dark"))"
_GREEN="$(rgb_to_rgba $(colour_from_xresources "col_green"))"
_GREY="$(rgb_to_rgba $(colour_from_xresources "col_white"))"
_BLUE="$(rgb_to_rgba $(colour_from_xresources "col_blue"))"
_BLUE_DARK="$(rgb_to_rgba $(colour_from_xresources "col_blue_dark"))"
_VIOLET="$(rgb_to_rgba $(colour_from_xresources "col_magenta"))"
_MAGENTA="$(rgb_to_rgba $(colour_from_xresources "col_red_dark"))"
_BLACK_DARK="$(rgb_to_rgba $(colour_from_xresources "col_black_dark"))"
_WHITE='#ffffffff'
_FG_COL="$_WHITE"
_BG_COL=$_BLACK_DARK

COLOR_BAR=($_FG_COL $_BG_COL)

COLOR_ACTIVE_MONITOR=($_FG_COL $_GREEN)
COLOR_INACTIVE_MONITOR=($_FG_COL $_BG_COL)
COLOR_FOCUSED_OCCUPIED=($_FG_COL $_RED)
COLOR_FOCUSED_FREE=($_FG_COL $_GREY)
#TODO fix wrt colour scheme
COLOR_FOCUSED_URGENT=('#FF34322E' '#FFF9A299')
#TODO fix wrt colour scheme
COLOR_URGENT=('#FFF9A299' '#FF34322E')
COLOR_OCCUPIED=($_FG_COL $_MAGENTA)

COLOR_FREE=($_FG_COL $_BG_COL)
COLOR_LAYOUT=($_FG_COL $_BLUE)
COLOR_TITLE=($_FG_COL $_BG_COL)
COLOR_STATUS=($_FG_COL $_BG_COL)


## Specific panel_bar colours
# TODO these are all the wrong way around
COLOR_PACKAGE_IMPORTANT=($_FG_COL $_RED)
COLOR_PACKAGE=($_FG_COL $_MAGENTA)
COLOR_PACKAGE_NONE=($_FG_COL $_BG_COL)

COLOR_NETWORK_TUN=($_FG_COL $_VIOLET)
COLOR_NETWORK_NORMAL=($_FG_COL $_GREEN)
COLOR_NETWORK_DIS=($_FG_COL $_RED)

COLOR_VOLUME_ON=($_FG_COL $_MAGENTA)
COLOR_VOLUME_OFF=($_FG_COL $(bar_color_bg COLOR_STATUS))

COLOR_BATTERY_LOW=($_FG_COL $_MAGENTA)
COLOR_BATTERY_NORMAL=($_FG_COL $(bar_color_bg COLOR_STATUS))

COLOR_HOSTNAME=($_FG_COL $(bar_color_bg COLOR_STATUS))

COLOR_CLOCK_NORMAL=($_FG_COL $_BG_COL)
COLOR_CLOCK_LATE=($_FG_COL $_RED)

COLOR_MUSIC_PLAYING=($_FG_COL $_GREEN)
COLOR_MUSIC_PAUSED=($_FG_COL $_ORANGE)
COLOR_MUSIC_STOPPED=($_FG_COL $_BLUE)

COLOR_LOAD_HIGH_TEMP=($_FG_COL $_RED)
COLOR_LOAD_NORMAL_TEMP=($_FG_COL $_BG_COL)
