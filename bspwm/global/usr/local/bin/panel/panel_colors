#!/usr/bin/env bash

. $HOME/.Xresourceshelper

get_bar_color_by_id () {
	# get_bar_color_by_id COLOR_BAR 1
	# http://stackoverflow.com/a/16461878
	local color_array_name
	local color_array
	color_array_name="$1[@]"
	color_array=("${!color_array_name}")
	echo -n "${color_array[$2]}"
}

# {{{
# the colour tuples are zero-indexed of the form (FG,BG,underline)
bar_color_fg () {
	get_bar_color_by_id "$1" "0"
}

bar_color_bg () {
	get_bar_color_by_id "$1" "1"
}

bar_color_underline () {
	get_bar_color_by_id "$1" "2"
}
# }}}

bar_color () {
	# i.e. bar_color COLOR_BAR "$(date)"
	local bg_col
	local fg_col
	local underline_col
	bg_col="$(bar_color_bg "$1")"
	fg_col="$(bar_color_fg "$1")"
	underline_col="$(bar_color_underline "$1")"

	# if we haven't got a underline colour set, simply use the background colour
	if [[ "$underline_col" == "" ]];
	then
		underline_col="${bg_col}"
	fi

	echo -n "%{B${bg_col}}%{F${fg_col}}%{U${underline_col}}%{+u}${@:2}%{-u}%{U-}%{F-}%{B-}"
}

bar_underline () {
	echo -n "%{U$1}%{+u}${@:2}%{-u}"
}

# Colour settings from our Xresources {{{
_BG="$(rgb_to_rgba $(colour_from_xresources "col_bg"))"
_FG="$(rgb_to_rgba $(colour_from_xresources "col_fg"))"

_BLACK="$(rgb_to_rgba $(colour_from_xresources "col_black"))"
_RED="$(rgb_to_rgba $(colour_from_xresources "col_red"))"
_GREEN="$(rgb_to_rgba $(colour_from_xresources "col_green"))"
_YELLOW="$(rgb_to_rgba $(colour_from_xresources "col_yellow"))"
_BLUE="$(rgb_to_rgba $(colour_from_xresources "col_blue"))"
_MAGENTA="$(rgb_to_rgba $(colour_from_xresources "col_magenta"))"
_CYAN="$(rgb_to_rgba $(colour_from_xresources "col_cyan"))"
_WHITE="$(rgb_to_rgba $(colour_from_xresources "col_white"))"

_BLACK_DARK="$(rgb_to_rgba $(colour_from_xresources "col_black_dark"))"
_RED_DARK="$(rgb_to_rgba $(colour_from_xresources "col_red_dark"))"
_GREEN_DARK="$(rgb_to_rgba $(colour_from_xresources "col_green_dark"))"
_YELLOW_DARK="$(rgb_to_rgba $(colour_from_xresources "col_yellow_dark"))"
_BLUE_DARK="$(rgb_to_rgba $(colour_from_xresources "col_blue_dark"))"
_MAGENTA_DARK="$(rgb_to_rgba $(colour_from_xresources "col_magenta_dark"))"
_CYAN_DARK="$(rgb_to_rgba $(colour_from_xresources "col_cyan_dark"))"
_WHITE_DARK="$(rgb_to_rgba $(colour_from_xresources "col_white_dark"))"
# }}}

# Colour aliases for ease-of-use {{{
_FG_COL="$_WHITE"
_BG_COL="$_BG"
_FOCUSSED=$_GREEN_DARK
_GREY="$_WHITE"
_VIOLET="$_MAGENTA"
# }}}

COLOR_BAR=($_FG_COL $_BG_COL)

# WM settings {{{
COLOR_ACTIVE_MONITOR=($_FG $_BG $_FOCUSSED)
COLOR_INACTIVE_MONITOR=($_FG $_BG)

COLOR_ACTIVE_OCCUPIED=($_FG $_BG $_FOCUSSED)
COLOR_INACTIVE_OCCUPIED=($_FG $_BG $_CYAN)

COLOR_ACTIVE_URGENT=($_BG $_RED_DARK $_RED)
COLOR_INACTIVE_URGENT=($_BG $_RED $_BG)

COLOR_ACTIVE_FREE=($_FG $_BG $_WHITE)
COLOR_INACTIVE_FREE=($_FG $_BG)

COLOR_LAYOUT=($_FG $_BG $_BLUE)
# }}}

COLOR_TITLE=($_FG $_BG)

# Package updates {{{
COLOR_PACKAGE_IMPORTANT=($_FG $_RED $_RED_DARK)
COLOR_PACKAGE=($_FG $_BG $_RED)
COLOR_PACKAGE_NONE=($_FG $_BG $_BG)
# }}}

# Network settings {{{
COLOR_NETWORK_TUN=($_FG $_BG $_VIOLET)
COLOR_NETWORK_NORMAL=($_FG $_BG $_GREEN)
COLOR_NETWORK_DIS=($_FG $_RED $_RED_DARK)
# }}}

# Volume colours {{{
COLOR_VOLUME_ON=($_FG $_BG $_MAGENTA)
COLOR_VOLUME_OFF=($_FG $_BG)
# }}}

# Battery colours {{{
COLOR_BATTERY_LOW=($_FG $_RED $_RED_DARK)
COLOR_BATTERY_NORMAL=($_FG $_BG)
# }}}

COLOR_HOSTNAME=($_FG_COL $_BG_COL)

# Display different colours dependent on the system time {{{
COLOR_CLOCK_NORMAL=($_FG $_BG)
COLOR_CLOCK_LATE=($_FG $_BG $_RED_DARK)
# }}}

# Music colours {{{
COLOR_MUSIC_PLAYING=($_FG $_BG $_GREEN)
COLOR_MUSIC_PAUSED=($_FG $_BG $_YELLOW)
# TODO this will never be used; when stopped there is no status output
COLOR_MUSIC_STOPPED=($_FG $_BG $_BLUE)
# }}}

# Temperature indicators {{{
COLOR_LOAD_HIGH_TEMP=($_FG $_RED $_RED_DARK)
COLOR_LOAD_MEDIUM_TEMP=($_BG $_YELLOW_DARK $_RED_DARK)
COLOR_LOAD_NORMAL_TEMP=($_FG $_BG)
# }}}
