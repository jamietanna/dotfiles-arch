#!/usr/bin/env ruby
require 'English'

commitish = ARGV[0] || 'HEAD'
changed = `git diff --name-only -r --cached '#{commitish}'`.split "\n"
exit $CHILD_STATUS.exitstatus unless $CHILD_STATUS.exitstatus.zero?

root = `git rev-parse --show-toplevel`.strip
cwd = File.join(Dir.pwd, '/')

changed.map! do |f|
  File.join(root, f)
end

changed.map! do |f|
  f.delete_prefix cwd
end

puts changed.join "\n"
